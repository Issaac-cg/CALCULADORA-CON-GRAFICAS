<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Calculadora de Derivadas con Gráficos</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjs/11.7.0/math.js"></script>
    <script src="https://cdn.plot.ly/plotly-2.24.1.min.js"></script>
    <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
    <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
</head>

<body class="bg-gray-50 min-h-screen">
    <div class="max-w-6xl mx-auto p-6">
        <div class="bg-white rounded-xl shadow-xl p-8 mb-8">
            <!-- Sección de entrada (igual que antes) -->
            
            <!-- Nueva sección de gráficos -->
            <div class="mt-8">
                <div id="grafico" class="h-96 w-full bg-gray-50 rounded-xl"></div>
            </div>

            <!-- Resto del código anterior... -->
        </div>
    </div>

    <script>
        function actualizarGrafico(funcion, derivada, variable) {
            try {
                const xValues = [];
                const yOriginal = [];
                const yDerivada = [];
                
                // Generar datos para el gráfico
                for(let i = -5; i <= 5; i += 0.2) {
                    const scope = {[variable]: i};
                    xValues.push(i);
                    yOriginal.push(math.evaluate(funcion, scope));
                    yDerivada.push(math.evaluate(derivada, scope));
                }

                // Configuración del gráfico
                const trace1 = {
                    x: xValues,
                    y: yOriginal,
                    mode: 'lines',
                    name: 'Función Original',
                    line: {color: '#3B82F6'}
                };

                const trace2 = {
                    x: xValues,
                    y: yDerivada,
                    mode: 'lines',
                    name: 'Derivada',
                    line: {color: '#10B981'}
                };

                const layout = {
                    title: `Comportamiento de f(${variable}) y su derivada`,
                    paper_bgcolor: '#f9fafb',
                    plot_bgcolor: '#f9fafb',
                    font: {family: 'Inter, sans-serif'},
                    xaxis: {title: variable, gridcolor: '#e5e7eb'},
                    yaxis: {title: 'f('+variable+')', gridcolor: '#e5e7eb'},
                    legend: {orientation: 'h', y: -0.2},
                    margin: {t: 40, r: 30, b: 60, l: 60}
                };

                Plotly.newPlot('grafico', [trace1, trace2], layout);
            } catch (error) {
                console.error('Error al generar gráfico:', error);
            }
        }

        function calcularDerivada(tipo) {
            try {
                // Cálculos anteriores...
                
                // Después de calcular la derivada
                const derivada = math.derivative(funcion, variable).toString();
                actualizarGrafico(funcion, derivada, variable);
                
                // Resto del código anterior...
            } catch (error) {
                alert(`Error: ${error.toString().replace('Error: ', '')}`);
            }
        }
    </script>
</body>
</html>
